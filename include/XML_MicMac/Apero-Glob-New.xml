<!--
    Innovation
-->

<Global >
   <ParamApero>

      <DicoLoc>


               <Symb>  TolLinkPPCD=0.2 </Symb> 
               <Symb>  SeuilFE=16.5 </Symb> 
               <Symb>  TetaLVM=0.01 </Symb>
               <Symb>  CentreLVM=0.1 </Symb>
               <Symb>  RayFEInit=0.85 </Symb>
               <Symb>  CalibIn="ABC" </Symb>

               <Symb>  FocMin=0 </Symb>
               <Symb>  FocMax=10000 </Symb>
               <Symb>  SetIm=NKS-Set-OfPatternAndFoc@[[${PatternAllIm}]]@${FocMin}@${FocMax} </Symb>

               <Symb>  SetImInit="XXXX" </Symb>

               <Symb>  FileCamInit=InitCamCenter.xml </Symb>
               <Symb>  AeroIn=XXXXXX </Symb>
               <Symb>  AeroOutGrid=-Grid${AeroOut} </Symb>
               <Symb>  RayonInvGrid=0.95  </Symb>

               <Symb>  ModeCDD=eCDD_Jamais </Symb>

               <Symb> VitesseInit=4 </Symb>
               <Symb> xPRelPP=0.5  </Symb>
               <Symb> yPRelPP=0.5  </Symb>
               <Symb> PropDiagU=1.0  </Symb>
               <Symb> SauvAutom=""  </Symb>
               <Symb> MOI=false  </Symb>
               <Symb> DebugPbCondFaisceau=false  </Symb>

               <Symb> ValDec=eLiberte_Phgr_Std_Dec </Symb>
               <Symb> ValAff=eLiberte_Phgr_Std_Aff </Symb>
               <Symb> RapTxt=""   </Symb>
               <Symb> PoseFigee="HUyZZ9_m@@9hyY" </Symb>



               <Symb>  DeuxIter=false </Symb>

               <Symb>  DoPP=true    </Symb>
               <Symb>  DoCD=true    </Symb>
               <Symb>  SetHom=""   </Symb>


               <Symb>  LibFoc=XXXX    </Symb>
               <Symb>  LibPP=XXXX    </Symb>
               <Symb>  LibCD=XXXX    </Symb>
               <Symb>  LibDec=XXXX    </Symb>

               <eSymb>  DoDR1=  SupEq ${DegRadMax} 1 </eSymb>
               <eSymb>  DoDR2=  SupEq ${DegRadMax} 2 </eSymb>
               <eSymb>  DoDR3=  SupEq ${DegRadMax} 3 </eSymb>
               <eSymb>  DoDR4=  SupEq ${DegRadMax} 4 </eSymb>
               <eSymb>  DoDR5=  SupEq ${DegRadMax} 5 </eSymb>
               <eSymb>  DoDR6=  SupEq ${DegRadMax} 6 </eSymb>
               <eSymb>  DoDR7=  SupEq ${DegRadMax} 7 </eSymb>
               <eSymb>  DoDR8=  SupEq ${DegRadMax} 8 </eSymb>
               <eSymb>  DoDR9=  SupEq ${DegRadMax} 9 </eSymb>
               <eSymb>  DoDR10=  SupEq ${DegRadMax} 10 </eSymb>
               <eSymb>  DoPPorCD= Or ${DoPP} ${DoCD}  </eSymb>
               <eSymb>  DoPPandCD= And  ${DoPP} ${DoCD}  </eSymb>

               <eSymb>  DoPolyn1=  SupEq ${DegGen} 1 </eSymb>
               <eSymb>  DoPolyn2=  SupEq ${DegGen} 2 </eSymb>
               <eSymb>  DoPolyn3=  SupEq ${DegGen} 3 </eSymb>
               <eSymb>  DoPolyn4=  SupEq ${DegGen} 4 </eSymb>
               <eSymb>  DoPolyn5=  SupEq ${DegGen} 5 </eSymb>
               <eSymb>  DoPolyn6=  SupEq ${DegGen} 6 </eSymb>
               <eSymb>  DoPolyn7=  SupEq ${DegGen} 7 </eSymb>


       </DicoLoc>

       <SectionBDD_Observation>
             <BDD_PtsLiaisons>
                 <Id>    Id_Pastis_Hom  </Id>
                 <KeySet> NKS-Set-Homol@${SetHom}@${Ext}  </KeySet>
                 <KeyAssoc>  NKS-Assoc-CplIm2Hom@${SetHom}@${Ext}   </KeyAssoc>
            </BDD_PtsLiaisons>

            <BDD_Orient>
                  <Id>  Or-Init   </Id>
                  <KeySet>  NKS-Set-Orient@${AeroIn} </KeySet>
                  <KeyAssoc>  NKS-Assoc-Im2Orient@${AeroIn} </KeyAssoc>
             </BDD_Orient>

       </SectionBDD_Observation>

       <SectionInconnues>

             <SeuilAutomFE>  ${SeuilFE} </SeuilAutomFE>

             <CalibrationCameraInc>
                   <Name> GenerateKC-Others   </Name>
                   <CalValueInit>
                         <CalibAutomNoDist>
                              <!-- <TypeDist> eCalibAutomRadial </TypeDist> -->
                              <TypeDist> ${ModeleCam} </TypeDist>
                              <PositionRelPP> ${xPRelPP} ${yPRelPP} </PositionRelPP>
                         </CalibAutomNoDist>

                         <CalFromFileExtern>
                              <NameFile>   ####  </NameFile>
                              <NameTag>    CalibrationInternConique </NameTag>
                              <AutorizeNonExisting > true </AutorizeNonExisting>
                         </CalFromFileExtern>
                   </CalValueInit>
                   <CalibPerPose>
                        <KeyPose2Cal> NKS-Assoc-FromFocMm@TheKeyCalib_@ </KeyPose2Cal>
                        <KeyInitFromPose>  NKS-Assoc-FromFocMm@Ori${CalibIn}/AutoCal@.xml  </KeyInitFromPose>
                    </CalibPerPose>
                   <RayMaxUtile>  ${RayFEInit} </RayMaxUtile>
                   <RayIsRelatifDiag  > true </RayIsRelatifDiag>
                   <RayApplyOnlyFE > true </RayApplyOnlyFE>
                   <PropDiagUtile> ${PropDiagU} </PropDiagUtile>
              </CalibrationCameraInc>


              <IncludeFileLoc>  ${FileCamInit} </IncludeFileLoc>

              <PoseCameraInc>
	           <PatternName>  ${SetIm}    </PatternName>
	           <CalcNameCalib>  GenerateKC-Others  </CalcNameCalib>
                   <InitNow> false </InitNow>
                   <MEP_SPEC_MST>
                           <Show> true </Show>
                           <MontageOnInit> ${MOI} </MontageOnInit>
                   </MEP_SPEC_MST>

		   <PosValueInit>
		        <PoseFromLiaisons>
                             <LiaisonsInit>
                                 <NameCam> ####  </NameCam>
				 <IdBD> Id_Pastis_Hom  </IdBD>
                             </LiaisonsInit>
		        </PoseFromLiaisons>
		   </PosValueInit>
              </PoseCameraInc>
        </SectionInconnues>


        <SectionChantier>
	     <DirectoryChantier> XXXX </DirectoryChantier>
             <GenereErreurOnContraineCam> false </GenereErreurOnContraineCam>
             <SauvAutom>  ${SauvAutom} </SauvAutom>
<!--
-->
             <SauvAutomBasic>  true </SauvAutomBasic>

             <DebugPbCondFaisceau> ${DebugPbCondFaisceau} </DebugPbCondFaisceau>

        </SectionChantier>

        <SectionSolveur>
              <ModeControleDescDic> ${ModeCDD} </ModeControleDescDic>
	      <ModeResolution> eSysL2BlocSym </ModeResolution> 
<!--
              <LimBsHRefut>  1e-3  </LimBsHRefut>
-->

              <SLMGlob> 
                 <RappelOnAngles>
                      <ParamF >
                          <PatternNameApply> .* </PatternNameApply>
                          <Incertitude> ${TetaLVM} </Incertitude>
                          <OnCur> true </OnCur>  
                       </ParamF>
                      <TetaApply> 0 </TetaApply>
                      <TetaApply> 1 </TetaApply>
                      <TetaApply> 2 </TetaApply>
                </RappelOnAngles>
                 <RappelOnCentres>
                      <ParamF> 
                             <PatternNameApply> .* </PatternNameApply>
                             <Incertitude> ${CentreLVM} </Incertitude>
                             <OnCur> true </OnCur>  
                      </ParamF>
                      <OnlyWhenNoCentreInit> true</OnlyWhenNoCentreInit>
                </RappelOnCentres>

             </SLMGlob>

        </SectionSolveur>



	<SectionCompensation>
	      <EtapeCompensation>
                   <IterationsCompensation>
                       <SectionContraintes>
                          <ContraintesCamerasInc>
                              <Val> eAllParamFiges  </Val>
                          </ContraintesCamerasInc>
                           <ContraintesPoses>
                                   <NamePose>   ${PoseFigee} </NamePose>
                                   <ByPattern>  true </ByPattern>
                                   <Val>      ePoseFigee   </Val>
                           </ContraintesPoses>
                       </SectionContraintes>
                       <Pose2Init>
                             <ProfMin> [2,${VitesseInit}] </ProfMin>
                             <Show> true </Show>
                       </Pose2Init>
                    </IterationsCompensation>


                    <IterationsCompensation> </IterationsCompensation>
                    <IterationsCompensation> </IterationsCompensation>


		    <SectionObservations>
                           <ObsLiaisons>
                              <NameRef> Id_Pastis_Hom </NameRef>
                              <Pond>
                                 <EcartMesureIndiv>  1.0 </EcartMesureIndiv>
                                 <Show> eNSM_Paquet     </Show>
                                 <NbMax>   100    </NbMax>
                                  <EcartMax> 100 </EcartMax>
                                  <SigmaPond> 5 </SigmaPond>
                                  <ModePonderation> eL1Secured </ModePonderation>
                              </Pond>
                           </ObsLiaisons>
		    </SectionObservations>

	      </EtapeCompensation>

	      <EtapeCompensation>
                    <IterationsCompensation> </IterationsCompensation>


                    <!-- D'abord 2 Coeff radiaux, car souvent focal instable -->
                    <#WHEN VTEST=${DoDR1}>
                         <IterationsCompensation>
                              <SectionContraintes>
                                    <ContraintesCamerasInc>
                                        <Val> eLiberte_DR1      </Val>
                                    </ContraintesCamerasInc>
                              </SectionContraintes>
                              <Messages>  LIB  DR1 </Messages>
                         </IterationsCompensation>
                         <#WHEN VTEST=${DeuxIter}> <IterationsCompensation> </IterationsCompensation> </#WHEN>
                    </#WHEN>
                    <#WHEN VTEST=${DoDR2}>
                         <IterationsCompensation>
                              <SectionContraintes>
                                    <ContraintesCamerasInc>
                                        <Val> eLiberte_DR2      </Val>
                                    </ContraintesCamerasInc>
                              </SectionContraintes>
                              <Messages>  LIB  DR2 </Messages>
                         </IterationsCompensation>
                         <#WHEN VTEST=${DeuxIter}> <IterationsCompensation> </IterationsCompensation> </#WHEN>
                    </#WHEN>


                    <!-- Liberer la focale qui est souvent assez fausse -->
                    <#WHEN VTEST=${LibFoc}>
                         <IterationsCompensation>
                              <SectionContraintes>
                                    <ContraintesCamerasInc>
                                        <Val> eLiberteFocale_1   </Val>
                                    </ContraintesCamerasInc>
                              </SectionContraintes>
                              <Messages>  Lib FOC </Messages>
                         </IterationsCompensation>
                         <#WHEN VTEST=${DeuxIter}> <IterationsCompensation> </IterationsCompensation> </#WHEN>
                    </#WHEN>

                    <!-- Liberer le point principal, aussi assez faux... -->
                    <#WHEN VTEST=${LibPP}>
                         <IterationsCompensation>
                              <SectionContraintes>
                                    <ContraintesCamerasInc>
                                        <Val> eLib_PP_CD_10   </Val>
                                    </ContraintesCamerasInc>
                                    <#WHEN VTEST=${LibCD}>
                                         <ContraintesCamerasInc>
                                              <Val> eLib_PP_CD_Lies      </Val>
                                              <TolContrainte>  1e-5 </TolContrainte>
                                         </ContraintesCamerasInc>
                                     </#WHEN>
                              </SectionContraintes>
                              <Messages>  Lib PP </Messages>
                         </IterationsCompensation>
                         <#WHEN VTEST=${DeuxIter}> <IterationsCompensation> </IterationsCompensation> </#WHEN>
                    </#WHEN>

                    <#WHEN VTEST=${DoDR3}>
                         <IterationsCompensation>
                              <SectionContraintes>
                                    <ContraintesCamerasInc>
                                        <Val> eLiberte_DR3      </Val>
                                    </ContraintesCamerasInc>
                              </SectionContraintes>
                              <Messages>  LIB  DR3 </Messages>
                         </IterationsCompensation>
                         <#WHEN VTEST=${DeuxIter}> <IterationsCompensation> </IterationsCompensation> </#WHEN>
                    </#WHEN>

                    <#WHEN VTEST=${LibCD}>
                         <IterationsCompensation>
                              <SectionContraintes>
                                    <ContraintesCamerasInc>
                                        <#IF VTEST=${LibPP}>
                                             <Val>  eLib_PP_CD_11    </Val>
                                             <Val>  eLib_PP_CD_01    </Val>
                                        </#IF>
                                    </ContraintesCamerasInc>
                              </SectionContraintes>
                              <Messages>  LIB  CD </Messages>
                         </IterationsCompensation>
                         <#WHEN VTEST=${DeuxIter}> <IterationsCompensation> </IterationsCompensation> </#WHEN>
                    </#WHEN>

                    <#WHEN VTEST=${DoPolyn1}>
                         <IterationsCompensation>
                              <SectionContraintes>
                                    <ContraintesCamerasInc>
                                        <Val> eLiberte_Phgr_Std_Aff      </Val>
                                        <Val> eLiberteParamDeg_1      </Val>
                                    </ContraintesCamerasInc>
                              </SectionContraintes>
                              <Messages>  LIB  Polyn1 </Messages>
                         </IterationsCompensation>
                    </#WHEN>

                    <#WHEN VTEST=${LibDec}>
                         <IterationsCompensation>
                              <SectionContraintes>
                                    <ContraintesCamerasInc>
                                        <Val> eLiberte_Dec1      </Val>
                                        <Val> eLiberte_Phgr_Std_Dec      </Val>
                                    </ContraintesCamerasInc>
                              </SectionContraintes>
                              <Messages>  LIB  Decentrik </Messages>
                         </IterationsCompensation>
                    </#WHEN>





                    <IterationsCompensation> </IterationsCompensation> 

		    <SectionObservations>
                           <ObsLiaisons>
                              <NameRef> Id_Pastis_Hom </NameRef>
                              <Pond>
                                 <EcartMesureIndiv>  1.0 </EcartMesureIndiv>
                                 <Show> eNSM_Paquet     </Show>
                                 <NbMax>   100    </NbMax>
                                  <EcartMax> 50 </EcartMax>
                                  <SigmaPond> 4 </SigmaPond>
                                  <ModePonderation> eL1Secured </ModePonderation>
                              </Pond>
                           </ObsLiaisons>
		    </SectionObservations>


	      </EtapeCompensation>

	      <EtapeCompensation>

                   <IterationsCompensation> </IterationsCompensation>
                   <IterationsCompensation> </IterationsCompensation>
                   <IterationsCompensation> </IterationsCompensation>
                   <IterationsCompensation> </IterationsCompensation>
                   <IterationsCompensation> 
                   </IterationsCompensation>

		    <SectionObservations>
                          <ObsLiaisons>
                              <NameRef> Id_Pastis_Hom </NameRef>
                              <Pond>
                                 <EcartMesureIndiv>  1.0 </EcartMesureIndiv>
                                 <Show> eNSM_Paquet     </Show>
                                 <NbMax>   100    </NbMax>
				 <ModePonderation>  eL1Secured </ModePonderation>
				 <SigmaPond> 2.0 </SigmaPond>
				 <EcartMax> 5.0 </EcartMax>
                              </Pond>
                          </ObsLiaisons>
                          <TxtRapDetaille>
                               <NameFile> ${RapTxt}</NameFile>
                         </TxtRapDetaille>
		    </SectionObservations>

                    <SectionExport>
                            <ExportPose>
                                <PatternSel> (.*) </PatternSel>
                                <KeyAssoc> NKS-Assoc-Im2Orient@${AeroOut} </KeyAssoc>
                                <AddCalib>  true </AddCalib>
                                <NbVerif>  10 </NbVerif>
                                <TolWhenVerif> 1e-3 </TolWhenVerif>
                                <FileExtern> NKS-Assoc-FromFocMm@Ori${AeroOut}/AutoCal@.xml </FileExtern>
                                <FileExternIsKey> true </FileExternIsKey>
                            </ExportPose>
                             <ExportCalib>
                                 <KeyAssoc>  NKS-Assoc-FromKeyCal@Ori${AeroOut}/AutoCal@.xml </KeyAssoc>
                                 <KeyIsName> false </KeyIsName>
                            </ExportCalib>
                    </SectionExport>
	      </EtapeCompensation>
	</SectionCompensation>

   </ParamApero>
</Global>

