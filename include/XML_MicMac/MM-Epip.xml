<!-- 
MICMAC /home/mpd/MMM/culture3d/include/XML_MicMac/MM-Epip.xml WorkDir=/media/data2/EPI/ +Im1=Epi_Im1_Left_17_18.tif +Im2=Epi_Im2_Right_17_18.tif +Zoom0=64 +CMS=true  +Purge=false

MICMAC /home/marc/MMM/culture3d/include/XML_MicMac/MM-Epip.xml WorkDir=/home/marc/TMP/EPI/ +Im1=Epi_Im1_Left_17_18.tif +Im2=Epi_Im2_Right_17_18.tif +Zoom0=64 +ZoomF=4

MICMAC /home/mpd/MMM/culture3d/include/XML_MicMac/MM-Epip.xml WorkDir=/media/data2/EPI/ +Im1=Epi_Im1_Left_41_0421_PAN_41_0422_PAN.tif +Im2=Epi_Im2_Right_41_0421_PAN_41_0422_PAN.tif +Zoom0=64 +ZoomF=4
-->
<ParamMICMAC>

<DicoLoc>

	<Symb>  ZReg=0.10  </Symb>
	<Symb>  DefCor=0.40  </Symb>
        <Symb>  PenteMax=1.0 </Symb>
	<Symb>  Interpol=eInterpolBiLin  </Symb>

	<Symb> Zoom0=64  </Symb>
	<Symb> ZoomF=1   </Symb>
	<Symb> ZPas=0.5   </Symb>
        <Symb> PrefMEC=MEC2Im </Symb>
        <Symb> Purge=true </Symb>
        <Symb> MulZMax=2.0 </Symb>
  <!-- Parametres essentiels -->

       <Symb> Ori=XXXXX    </Symb>
       <Symb> Im1=Epi_Im1_Left_17_18.tif     </Symb>
       <Symb> Im2=Epi_Im2_Right_17_18.tif     </Symb>
       <Symb> IncPix=400   </Symb>
       <Symb> NbDirProg=4   </Symb>
       <Symb> CMS=false   </Symb>
       <Symb> Census=true   </Symb>
       <Symb> SquareW=true   </Symb>


       <Symb> DebugClip=true  </Symb>
       <Symb> SzW0=2  </Symb>
       <Symb> DeltaY=0  </Symb>
       <Symb> Verif=false  </Symb>

  <!-- Parametres calcule -->
        <Symb>  DirMEC=MEC2Im-Censu${Census}-${Im1}-${Im2} </Symb>
        <eSymb> DbleZPas=* 2 ${ZPas} </eSymb>
        <eSymb> MulZMin=/ 1  ${MulZMax} </eSymb>

           <!-- Ici * joue le role de && --> 
        <eSymb> WZ64=* Sup ${Zoom0} 64  InfEq  ${ZoomF} 64  </eSymb>
        <eSymb> WZ32=* Sup ${Zoom0} 32  InfEq  ${ZoomF} 32  </eSymb>
        <eSymb> WZ16=* Sup ${Zoom0} 16  InfEq  ${ZoomF} 16  </eSymb>
        <eSymb> WZ8=*  Sup ${Zoom0} 8   InfEq  ${ZoomF} 8  </eSymb>
        <eSymb> WZ4=*  Sup ${Zoom0} 4   InfEq  ${ZoomF} 4  </eSymb>
        <eSymb> WZ2=*  Sup ${Zoom0} 2   InfEq  ${ZoomF} 2  </eSymb>
        <eSymb> WZ1=*  Sup ${Zoom0} 1   InfEq  ${ZoomF} 1  </eSymb>
        <eSymb> SzW= ? ${CMS} 1 ${SzW0}  </eSymb>

        <eSymb> SzWy= ? ${CMS} 1 + ${DeltaY} ${SzW} </eSymb>
       
</DicoLoc>

<Section_Terrain> 
     <IntervParalaxe>
              <Px1IncCalc> ${IncPix} </Px1IncCalc>
     </IntervParalaxe>

     <GeoRefAutoRoundResol> false </GeoRefAutoRoundResol>


</Section_Terrain>


<!--  ************************************************************* 

         Parametres lies a la prise de vue,
         independamment de son exploitation
         par le correlateur
-->
<Section_PriseDeVue>
   <GeomImages> eGeomImage_EpipolairePure </GeomImages> 
<!--
   <ValSpecNotImage> 0  </ValSpecNotImage>
-->

   <Images>
    	<Im1>   ${Im1} </Im1>
    	<Im2>   ${Im2}    </Im2>
   </Images>

   <MasqImageIn>
             <OneMasqueImage>
                <PatternSel>  (.*).tif  </PatternSel>
                <NomMasq>  $1_Masq.tif     </NomMasq>
             </OneMasqueImage>
             <AcceptNonExistingFile> false </AcceptNonExistingFile>
    </MasqImageIn>

    
<!--
    <NomsGeometrieImage>
         <FCND_Mode_GeomIm>
               <FCND_GeomCalc>  NKS-Assoc-Im2Orient@-${Ori}  </FCND_GeomCalc>
         </FCND_Mode_GeomIm>
    </NomsGeometrieImage>
-->
</Section_PriseDeVue>


<!--  *************************************************************
       Parametres fixant le comportement
     de l'algo de mise en correspondance
-->
<Section_MEC>
	<ChantierFullImage1> true </ChantierFullImage1>

	<EtapeMEC>
    	    <DeZoom> -1 </DeZoom>
    	    <ModeInterpolation> ${Interpol} </ModeInterpolation>
<!--
            <CorrelMin>    0.5 </CorrelMin>
            <GammaCorrel>  3  </GammaCorrel>
-->

	    <AggregCorr> eAggregIm1Maitre </AggregCorr>
		
	    <!-- param correl -->
	    <SzW> ${SzW} </SzW>
	    <SzWy>  ${SzWy} </SzWy>
            <AlgoRegul> eAlgo2PrgDyn </AlgoRegul>
	    <Px1Pas> ${ZPas} </Px1Pas>
            <Px1DilatAlti>  3  </Px1DilatAlti>
	    <Px1DilatPlani> 3  </Px1DilatPlani>
	    <GenImagesCorrel> true </GenImagesCorrel>
	    
	
            <!-- param regul -->
	    <Px1Regul> ${ZReg} </Px1Regul>
            <SsResolOptim> 1 </SsResolOptim>
            <CoxRoyUChar> false </CoxRoyUChar>


	    <ModulationProgDyn>
               <EtapeProgDyn>
            	   <ModeAgreg> ePrgDAgrSomme </ModeAgreg>
                   <NbDir> ${NbDirProg} </NbDir>
               </EtapeProgDyn>
               <Px1PenteMax> ${PenteMax} </Px1PenteMax>
               <ArgMaskAuto>
            	   <ValDefCorrel> ${DefCor} </ValDefCorrel>
                   <CostTrans> 2.0 </CostTrans>
                   <ReInjectMask> false </ReInjectMask> 
               </ArgMaskAuto>
            </ModulationProgDyn>

            <CorrelAdHoc>
                 <#WHEN VTEST=${DebugClip}>
                        <SzBlocAH> 40000000 </SzBlocAH>
                 </#WHEN>


                 <#WHEN VTEST=${CMS}>
                     <CorrelMultiScale>
                            <ModeDense> true </ModeDense>
                            <UseWAdapt> false </UseWAdapt>
                            <OneParamCMS>
                                 <SzW> 1 1 </SzW>
                                 <Sigma> 0 </Sigma>
                                 <Pds> 1.0 </Pds>
                                 <SquareW> ${SquareW} </SquareW>
                            </OneParamCMS>
                            <OneParamCMS>
                                 <SzW> 2 2 </SzW>
                                 <Sigma> 1.0 </Sigma>
                                 <Pds> 0.5 </Pds>
                                 <SquareW> ${SquareW} </SquareW>
                            </OneParamCMS>
                            <OneParamCMS>
                                 <SzW> 4 3 </SzW>
                                 <Sigma> 2.0 </Sigma>
                                 <Pds> 0.25 </Pds>
                                 <SquareW> ${SquareW} </SquareW>
                            </OneParamCMS>
                     </CorrelMultiScale>
                 </#WHEN>
                   

                 <TypeCAH>
                     <#IF VTEST=${Census}>
                         <CensusCost>
                             <TypeCost> eMCC_CensusBasic   </TypeCost>
<!--
                             <TypeCost> eMCC_CensusCorrel   </TypeCost>
                             <TypeCost> eMCC_GrCensus   </TypeCost>
-->
                             <Verif>  ${Verif} </Verif>
                             <AttenDist>   0.0 </AttenDist>
                         </CensusCost>
                         <GPU_Correl>
                         </GPU_Correl>
                     </#IF>
                  </TypeCAH>
             </CorrelAdHoc>


        </EtapeMEC>

	<EtapeMEC> 
                  <DeZoom> ${Zoom0} </DeZoom> 
                  <Px1Pas>  1 </Px1Pas>
        </EtapeMEC>	
	<EtapeMEC> 
                  <DeZoom> ${Zoom0} </DeZoom> 
                 <Px1DilatAlti>  5  </Px1DilatAlti>
	         <Px1DilatPlani> 3  </Px1DilatPlani>
        </EtapeMEC>	

        <#WHEN VTEST=${WZ64}>
	    <EtapeMEC> 
                  <DeZoom> 64 </DeZoom> 
            </EtapeMEC>	
        </#WHEN>

        <#WHEN VTEST=${WZ32}>
	    <EtapeMEC> 
                  <DeZoom> 32 </DeZoom> 
            </EtapeMEC>	
        </#WHEN>


        <#WHEN VTEST=${WZ16}>
	    <EtapeMEC> 
                  <DeZoom> 16 </DeZoom> 
            </EtapeMEC>
        </#WHEN>

        <#WHEN VTEST=${WZ8}>
	   <EtapeMEC> 
              <DeZoom> 8 </DeZoom> 
           </EtapeMEC>
        </#WHEN>


        <#WHEN VTEST=${WZ4}>
	     <EtapeMEC> 
                   <DeZoom> 4 </DeZoom>         
	           <ModulationProgDyn>
                      <EtapeProgDyn>
            	        <ModeAgreg> ePrgDAgrSomme </ModeAgreg>
                        <NbDir> ${NbDirProg} </NbDir>
                      </EtapeProgDyn>
                      <Px1PenteMax> ${PenteMax} </Px1PenteMax>
                      <ArgMaskAuto>
            	        <ValDefCorrel>  ${DefCor}  </ValDefCorrel>
                        <CostTrans> 2.0 </CostTrans>
                        <ReInjectMask> false </ReInjectMask> 
                      </ArgMaskAuto>
                   </ModulationProgDyn>
             </EtapeMEC>
        </#WHEN>

        <#WHEN VTEST=${WZ2}>
	      <EtapeMEC> 
                    <DeZoom> 2 </DeZoom>         
	            <ModulationProgDyn>
                       <EtapeProgDyn>
            	         <ModeAgreg> ePrgDAgrSomme </ModeAgreg>
                         <NbDir> ${NbDirProg} </NbDir>
                       </EtapeProgDyn>
                       <Px1PenteMax> ${PenteMax} </Px1PenteMax>
                       <ArgMaskAuto>
            	         <ValDefCorrel>  ${DefCor}  </ValDefCorrel>
                         <CostTrans> 2.0 </CostTrans>
                         <ReInjectMask> false </ReInjectMask> 
                       </ArgMaskAuto>
                    </ModulationProgDyn>
              </EtapeMEC>
        </#WHEN>

        <#WHEN VTEST=${WZ1}>
	   <EtapeMEC> 
                 <DeZoom> 1 </DeZoom>         
                 <Px1DilatAlti>  2  </Px1DilatAlti>
	         <Px1DilatPlani> 2  </Px1DilatPlani>
	         <ModulationProgDyn>
                    <EtapeProgDyn>
            	      <ModeAgreg> ePrgDAgrSomme </ModeAgreg>
                      <NbDir> ${NbDirProg} </NbDir>
                    </EtapeProgDyn>
                    <Px1PenteMax> ${PenteMax} </Px1PenteMax>
                    <ArgMaskAuto>
            	      <ValDefCorrel>  ${DefCor}  </ValDefCorrel>
                      <CostTrans> 2.0 </CostTrans>
                      <ReInjectMask> false </ReInjectMask> 
                    </ArgMaskAuto>
                 </ModulationProgDyn>
              </EtapeMEC>
        </#WHEN>

	<EtapeMEC> 
              <DeZoom> ${ZoomF} </DeZoom>         
	      <Px1Pas>   1.0 </Px1Pas>
              <AlgoRegul> eAlgoDequant </AlgoRegul>
        </EtapeMEC>
       
</Section_MEC>

<!--  *************************************************************
       Parametres fixant les resultats
     devant etre produits par l'algo
-->
<Section_Results>
    <GeomMNT> eGeomPxBiDim     </GeomMNT>
<!--
    <DoMEC> true </DoMEC> 
    <DoNothingBut>
            <ButDoOriMNT>  true </ButDoOriMNT>
    </DoNothingBut>

    <NonExistingFileDoMEC>  ${DirMEC}/Z_Num8_DeZoom2_LeChantier.tif </NonExistingFileDoMEC>
-->

    <DoFDC> true </DoFDC>
    <ZoomMakeTA> 32 </ZoomMakeTA>
    <GammaVisu> 2.0 </GammaVisu>
    <ZoomVisuLiaison> -1 </ZoomVisuLiaison>
    
</Section_Results>

<!--  *************************************************************
       Parametres lies a la gestions
     du "chantier" sur la machine
-->
<Section_WorkSpace>

<!--
    <MapMicMac>
         <ActivateCmdMap> true </ActivateCmdMap>
         <ModeCmdMapeur>
            <CM_Set>
                <KeySet> NKS-Set-OfPattern@${PatAllIm} </KeySet>
                <NameVarMap> Im1 </NameVarMap>
             </CM_Set>
        </ModeCmdMapeur>

         <CmdMapRel>
              <KeyRel>  Key-Pair-To-Match </KeyRel>
              <NameArc>  Im2 </NameArc>
         </CmdMapRel>

    </MapMicMac>
-->

<!--
    <FirstEtapeMEC> 8 </FirstEtapeMEC>
    <LastEtapeMEC> 5 </LastEtapeMEC>
-->


    <WorkDir> ThisDir </WorkDir> 
    <TmpMEC> ${DirMEC}/ </TmpMEC>
    <TmpResult> ${DirMEC}/ </TmpResult>
    <TmpPyr> Pyram/ </TmpPyr>
    <PurgeMECResultBefore>  ${Purge} </PurgeMECResultBefore>
    <ByProcess>  ${MMNbProc} </ByProcess>
<!--
    <ByProcess>  1 </ByProcess>
-->
    <AvalaibleMemory> 1024 </AvalaibleMemory>
    <SzDalleMin> 400 </SzDalleMin>
    <SzDalleMax> 1000 </SzDalleMax>
    <SzRecouvrtDalles> 20 </SzRecouvrtDalles>
    <SzMinDecomposCalc> 40 </SzMinDecomposCalc>
</Section_WorkSpace>

<Section_Vrac> 
     <DebugMM> true</DebugMM>
</Section_Vrac>

</ParamMICMAC>

